# 路由

本篇主要讲解在Laravel框架中路由的基本知识，主要参考中文文档中的路由章节，并融合自己的理解。以通俗易懂的方式来解析Laravel框架中最重要的路由知识。

-------------------------

## 1.前提知识

学习Laravel路由之前我们好好了解以下几个知识
第一个就是 —— HTTP 协议基础。不要求完全了解 HTTP 协议，但必须要知道一小部分概念。如果对其不了解，会在阅读 laravel 文档时出现很多疑惑。对于HTTP协议的理解可以参考这篇文章[深入理解HTTP协议](https://mp.weixin.qq.com/s/AK1Pb9rx0q5Hf8dq6HNOhw)。

第二个是 —— RESTful，这是一种设计思想，这对学习 laravel 的路由有很大的帮助，尤其是在学习 laravel 控制器的资源控制器部分，很多人的疑惑都是在不了解 RESTful 的情况下产生的。阮一峰的日志中有两篇详细讲解了 RESTful，其中一篇是[理解RESTful架构](http://www.ruanyifeng.com/blog/2011/09/restful.html)。



## 2.路由的学习

### ①路由的定义文件
所有的 Laravel 路由都在 routes 目录中的路由文件中定义，这些文件都由框架自动加载。routes/web.php 文件用于定义 web 界面的路由。这里面的路由都会被分配给 web 中间件组，它提供了会话状态和 CSRF 保护等功能。定义在 routes/api.php 中的路由都是无状态的，并且被分配了 api 中间件组。

大多数的应用构建，都是以在 routes/web.php 文件定义路由开始的。可以通过在浏览器中输入定义的路由 URL 来访问 routes/web.php 中定义的路由。例如，你可以在浏览器中输入 http://your-app.dev/user 来访问以下路由

```
Route::get('/user', 'UserController@index');

```

### ②基本路由

构建基本的路由只需要一个 URI 与一个 闭包函数（什么是闭包函数，想了解更多闭包函数，请看这篇[PHP的闭包](https://www.cnblogs.com/yjf512/archive/2012/10/29/2744702.html)） ，这里提供了一个非常简单优雅定义路由的方法：

```
Route::get('foo', function () {
    return 'Hello World';
});

```

### ③可用的路由方法

路由器允许你注册能响应任何 HTTP 请求的路由，大致有以下七种

```
Route::get('books', ‘BooksController@index');           //获取
Route::post('books', 'BookController@store');           //保存
Route::get('books/create', 'BookController@create');    //创建 
Route::get('books/:id', 'BookController@show');         //显示
Route::put('books/:id', 'BookController@update');       //更新
Route::delete('books/:id', 'BookController@destroy');   //删除
Route::get('books/:id/edit', 'BookController@edit');    //编辑
```
以上的七种方法可以用Route:source的方法来进行总结使用。

```
Route::resource(‘books’, ‘BooksController’); 
```

有的时候你可能需要注册一个可响应多个 HTTP 请求的路由，这时你可以使用 match 方法，也可以使用 any 方法注册一个实现响应所有 HTTP 请求的路由,但是根据面向对象的单一职责原则，一个类或者一个模块应该有且只有一个职责，所以不推荐使用。(什么是单一职责原则？请看这篇文章[单一职责原则](https://www.cnblogs.com/silencer/p/10812466.html))

```
Route::match(['get', 'post'], '/', function () {
    //
});

Route::any('foo', function () {
    //
});

```

### ④重定向路由
如果要定义重定向到另一个 URI 的路由，可以使用 Route::redirect 方法。这个方法可以快速的实现重定向，而不再需要去定义完整的路由或者控制器:

```
Route::redirect('/here', '/there');

```
Route::redirect 默认会返回状态码 302 。 你可以通过第三个参数自定义返回码：

```
Route::redirect('/here', '/there', 301);

```

你也可以使用 Route::permanentRedirect 方法来返回 301 状态码：

```
Route::permanentRedirect('/here', '/there');

```

### ⑤视图路由

如果你的路由只需要返回一个视图，可以使用 Route::view 方法。它和 redirect 一样方便，不需要定义完整的路由或控制器。
view 方法有三个参数，其中第一个是必填参数，是包含视图名称的 URI 。第二个也是必填参数，是需要渲染的视图名称。第三个参数是可选参数，可以传入一个数组，数组中的数据会被传递给视图:

```
Route::view('/welcome',  'welcome');      //参数1:URL 参数2:视图名称 

Route::view('/welcome', 'welcome', ['name' => 'Taylor']); //参数1:URL 参数2:视图名称  参数3:可选参数(可以传数组)

```

### ⑥路由参数

#### 1>必填参数

当然，有时需要在路由中捕获一些 URL 片段。例如，从 URL 中捕获用户的 ID，可以通过定义路由参数来执行此操作：

```
Route::get('user/{id}', function ($id) {
    return 'User '.$id;
});
```

也可以根据需要在路由中定义多个参数：

```
Route::get('posts/{post}/comments/{comment}', function ($postId, $commentId) {
    //
});
```
路由的参数通常都会被放在 {} 内，并且参数名只能为**字母**，同时路由参数不能包含-符号，如果需要可以用下划线 (_) 代替。路由参数会按顺序依次被注入到路由回调或者控制器中，而不受回调或者控制器的参数名称的影响。


#### 2>可选参数

有时，你可能需要指定一个路由参数，但你希望这个参数是可选的。你可以在参数后面加上 **?** 标记来实现，但前提是要确保路由的相应变量有默认值

```
Route::get('user/{name?}', function ($name = null) {
    return $name;
});

Route::get('user/{name?}', function ($name = 'John') {
    return $name;
});
```

#### 3>正则表达式约束

你可以使用路由实例上的 where 方法约束路由参数的格式。where 方法接受参数名称和定义参数应如何约束的正则表达式：

```
Route::get('user/{name}', function ($name) {
    //
})->where('name', '[A-Za-z]+');

Route::get('user/{id}', function ($id) {
    //
})->where('id', '[0-9]+');

Route::get('user/{id}/{name}', function ($id, $name) {
    //
})->where(['id' => '[0-9]+', 'name' => '[a-z]+']);

```
#### 4>全局约束

如果你希望某个具体的路由参数都遵循同一个正则表达式的约束，就使用 pattern 方法在 \app\Providers\RouteServiceProvider 的 boot 方法中定义这些模式：

```
/**
 * 定义你的路由模型绑定, pattern 过滤器等。
 *
 * @return void
 */
public function boot()
{
    Route::pattern('id', '[0-9]+');

    parent::boot();
}
```

一旦定义好之后，便会自动应用这些规则到所有使用该参数名称的路由上：

```
Route::get('user/{id}', function ($id) {
    // 只有在 id 为数字时才执行。
});

```
### ⑦路由命名
路由命名可以方便地为指定路由生成 URL 或者重定向。通过在路由定义上链式调用 name 方法可以指定路由名称：

```
Route::get('user/profile', function () {
    //
})->name('profile');
```
你还可以指定控制器行为的路由名称：

```
Route::get('user/profile', 'UserProfileController@show')->name('profile');
```

生成指定路由的 URL
为路由指定了名称后，就可以使用全局辅助函数 route 来生成链接或者重定向到该路由：

```
// 生成 URL...
$url = route('profile');

// 生成重定向...
return redirect()->route('profile');
```

如果是有定义参数的命名路由，可以把参数作为 route 函数的第二个参数传入，指定的参数将会自动插入到 URL 中对应的位置：

```
Route::get('user/{id}/profile', function ($id) {
    //
})->name('profile');

$url = route('profile', ['id' => 1]);
```

检查当前路由
如果你想判断当前请求是否指向了某个路由，你可以调用路由实例上的 named 方法。例如，你可以在路由中间件中检查当前路由名称：

```
/**
 * 处理一次请求。
 *
 * @param  \Illuminate\Http\Request  $request
 * @param  \Closure  $next
 * @return mixed
 */
public function handle($request, Closure $next)
{
    if ($request->route()->named('profile')) {
        //
    }

    return $next($request);
}
```










